# oRm: An Object-Relational Mapping (ORM) Framework for R

**oRm** is a lightweight ORM for R. Define models, insert data, and
query relationships without writing raw SQL.

------------------------------------------------------------------------

## ðŸ”§ Installation

``` r
remotes::install_github("kent-orr/oRm")
```

## ðŸš€ Quickstart

### 1. Create Engine

``` r
library(oRm)

engine <- Engine$new(
  drv = RSQLite::SQLite(),
  dbname = ":memory:",
  persist = TRUE
)
```

For PostgreSQL connections, you can set a default schema that will be
used for `search_path` and by `model()` when no schema is supplied:

``` r
engine <- Engine$new(
  drv = RPostgres::Postgres(),
  dbname = "mydb",
  .schema = "custom_schema"
)
```

### 2. Define Models

``` r
User <- engine$model(
  "users",
  id = Column("INTEGER", primary_key = TRUE, nullable = FALSE),
  organization_id = ForeignKey("INTEGER", references = "organizations.id"),
  name = Column("TEXT", nullable = FALSE),
  age = Column("INTEGER")
)

Organization <- engine$model(
  "organizations",
  id = Column("INTEGER", primary_key = TRUE, nullable = FALSE),
  name = Column("TEXT", nullable = FALSE)
)

Organization$create_table()
User$create_table()
```

### 3. Add Relationship

``` r
User |> define_relationship(
  local_key = "organization_id",
  type = "belongs_to",
  related_model = Organization,
  related_key = "id",
  ref = "organization",
  backref = "users"
)
```

### 4. Insert Records

``` r
Organization$record(id = 1L, name = "Widgets, Inc")$create()
User$record(id = 1L, organization_id = 1L, name = "Kent", age = 34)$create()
User$record(id = 2L, organization_id = 1L, name = "Dylan", age = 25)$create()
```

### 5. Query Records

``` r
kent <- User$read(id == 1, .mode = "get")
kent$data$name

org <- kent$relationship("organization")
org$data$name

org$relationship("users")  # list of user records
```

### 6. CRUD API

``` r
u <- User$record(id = 5, name = "hogan")
u$create()
u <- User$read(id == 5)
u$data$name <- "Hogan"
u$update()
u$delete()
```

------------------------------------------------------------------------

Early-stage project. Feedback welcome!

# Package index

## All functions

- [`Column()`](https://kent-orr.github.io/oRm/reference/Column.md) :
  Define a basic column for a database table
- [`Engine`](https://kent-orr.github.io/oRm/reference/Engine.md) :
  Engine Class
- [`ForeignKey()`](https://kent-orr.github.io/oRm/reference/ForeignKey.md)
  : Define a foreign key column
- [`Method()`](https://kent-orr.github.io/oRm/reference/Method.md) :
  Define a method to attach to a model
- [`Record`](https://kent-orr.github.io/oRm/reference/Record.md) :
  Record Class
- [`Relationship`](https://kent-orr.github.io/oRm/reference/Relationship.md)
  : Relationship Class
- [`TableModel`](https://kent-orr.github.io/oRm/reference/TableModel.md)
  : TableModel Class
- [`define_relationship()`](https://kent-orr.github.io/oRm/reference/define_relationship.md)
  : Define a relationship between two models
- [`render_constraint()`](https://kent-orr.github.io/oRm/reference/render_constraint.md)
  : Write teh sql for a foreign key column
- [`render_field()`](https://kent-orr.github.io/oRm/reference/render_field.md)
  : Render a column field to SQL
- [`render_field(`*`<default>`*`)`](https://kent-orr.github.io/oRm/reference/render_field.default.md)
  : Write the sql for creating a sql column
- [`with(`*`<Engine>`*`)`](https://kent-orr.github.io/oRm/reference/with.Engine.md)
  : Transaction Function
- [`with(`*`<Record>`*`)`](https://kent-orr.github.io/oRm/reference/with.Record.md)
  : Evaluate an expression within a Record's data.

# Articles

### Quickstart

- [Get Started](https://kent-orr.github.io/oRm/articles/get_started.md):
- [Why oRm](https://kent-orr.github.io/oRm/articles/why_oRm.md):

### Using the ORM

- [Using
  Engine](https://kent-orr.github.io/oRm/articles/using-engine.md):
- [Using
  TableModels](https://kent-orr.github.io/oRm/articles/using-tablemodels.md):
- [Using
  Records](https://kent-orr.github.io/oRm/articles/using-records.md):
- [Using
  Relationships](https://kent-orr.github.io/oRm/articles/using-relationships.md):
- [Using
  Methods](https://kent-orr.github.io/oRm/articles/using-methods.md):

### Advanced Topics

- [oRm with
  Shiny](https://kent-orr.github.io/oRm/articles/with_shiny.md):
- [Developing
  Dialects](https://kent-orr.github.io/oRm/articles/developing-dialects.md):
