<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>oRm with Shiny • oRm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="oRm with Shiny">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oRm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quickstart</h6></li>
    <li><a class="dropdown-item" href="../articles/get_started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/why_oRm.html">Why oRm</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Using the ORM</h6></li>
    <li><a class="dropdown-item" href="../articles/using-engine.html">Using Engine</a></li>
    <li><a class="dropdown-item" href="../articles/using-tablemodels.html">Using TableModels</a></li>
    <li><a class="dropdown-item" href="../articles/using-records.html">Using Records</a></li>
    <li><a class="dropdown-item" href="../articles/using-relationships.html">Using Relationships</a></li>
    <li><a class="dropdown-item" href="../articles/using-methods.html">Using Methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/with_shiny.html">oRm with Shiny</a></li>
    <li><a class="dropdown-item" href="../articles/developing-dialects.html">Developing Dialects</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kent-orr/oRm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>oRm with Shiny</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kent-orr/oRm/blob/HEAD/vignettes/with_shiny.Rmd" class="external-link"><code>vignettes/with_shiny.Rmd</code></a></small>
      <div class="d-none name"><code>with_shiny.Rmd</code></div>
    </div>

    
    
<p><code>oRm</code> was conceived as a means of handling database
interactions in R shiny, much like <code>sqlalchemy</code> in python
flask applications. It can be a useful tool for handling CRUD operations
such as interactive tables, forms, and UI elements. In this vignette
we’ll focus on the basics of <code>oRm</code> and how it can be used to
build a simple CRUD application.</p>
<div class="section level2">
<h2 id="form-inputs">Form Inputs<a class="anchor" aria-label="anchor" href="#form-inputs"></a>
</h2>
<p>Let’s imagine we have a simple shiny app that allows team members to
add observations to a database. We’ll demonstrate an observeEvent
handler that creates a new observation in the database when a button is
clicked. For demonstration purposes, we’ll consdier that the data is
plant heights and the team members are represented by IDs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># in global.R =====</span></span>
<span><span class="va">engine</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Engine.html">Engine</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  drv <span class="op">=</span> <span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">":memory:"</span>,</span>
<span>  persist <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Optional for in-memory databases</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Observations</span> <span class="op">&lt;-</span> <span class="va">engine</span><span class="op">$</span><span class="fu">model</span><span class="op">(</span></span>
<span>    <span class="st">"observations"</span>,</span>
<span>    observer_id <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Integer'</span>, primary_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    plant_subject_id <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Integer'</span><span class="op">)</span>,</span>
<span>    plant_height <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Numeric'</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># =====</span></span>
<span></span>
<span><span class="co"># in server.R =====</span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add_observation</span>, <span class="op">{</span></span>
<span>    <span class="co"># observer_id and plant_height are the values from the form inputs</span></span>
<span>    <span class="va">observation</span> <span class="op">=</span> <span class="va">Observations</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>        observer_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">observer_id</span>,</span>
<span>        plant_subject_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">plant_subject_id</span>,</span>
<span>        plant_height <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">plant_height</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">observation</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu">showNotification</span><span class="op">(</span><span class="st">"Observation added!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>In a simple application, this can quickly achieve CRUD functionality.
However, for a full-featured application, more sophisticated features
like validation and error handling would be necessary. To allow for that
logic to be implemented we might want to take advantage of a database
transaction state. For that, take a look at the <code>with.Engine</code>
section in this document.</p>
</div>
<div class="section level2">
<h2 id="paging-results">Paging Results<a class="anchor" aria-label="anchor" href="#paging-results"></a>
</h2>
<p>Large tables need broken up or your browser may tank. Paging is a
good way to handle this. Popular table packages like <code>DT</code> or
<code>reactable</code> provide built-in support for pagination, but what
if you want to implement something like a carousel of card elements, or
sets of plots?</p>
<p>To enable pagination in your application, you’ll need to modify your
query to limit the number of results returned and also include a
<code>LIMIT</code> and <code>OFFSET</code> clause. Let’s say we want to
display the observations as cards in a uiOutput, but we only want to
show the last 5 cards.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">displayed_observations</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">page_no</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">page_no</span></span>
<span>    <span class="va">offset</span> <span class="op">=</span> <span class="op">(</span><span class="va">page_no</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5</span>  <span class="co"># Assuming 5 observations per page</span></span>
<span></span>
<span>    <span class="va">observations</span> <span class="op">=</span> <span class="va">Observations</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span></span>
<span>        .order_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">observer_id</span><span class="op">)</span><span class="op">)</span>, </span>
<span>        .limit <span class="op">=</span> <span class="fl">5</span>, </span>
<span>        .offset <span class="op">=</span> <span class="va">offset</span></span>
<span>        <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">observations</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">observation_cards</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">observations</span> <span class="op">=</span> <span class="fu">displayed_observations</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu">tagList</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">observations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">observation</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu">card</span><span class="op">(</span></span>
<span>                <span class="fu">card_title</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Plant ID:"</span>, <span class="va">observation</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">plant_subject_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">card_body</span><span class="op">(</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Observer ID:"</span>, <span class="va">observation</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">observer_id</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Plant Height:"</span>, <span class="va">observation</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">plant_height</span><span class="op">)</span></span>
<span>                    <span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dropdowns-and-filters">Dropdowns and Filters<a class="anchor" aria-label="anchor" href="#dropdowns-and-filters"></a>
</h2>
<p>Inevitably shiny applications need a dynamically created dropdown
that users can select from. <code>oRm</code> can help manage lookup
tables in an oop manner instead of using SQL queries directly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Users</span> <span class="op">&lt;-</span> <span class="va">engine</span><span class="op">$</span><span class="fu">model</span><span class="op">(</span></span>
<span>    <span class="st">"users"</span>,</span>
<span>    user_id <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Integer'</span>, primary_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    user_name <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'String'</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">check_options</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">users</span> <span class="op">=</span> <span class="va">Users</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">choices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">users</span>, <span class="kw">function</span><span class="op">(</span><span class="va">user</span><span class="op">)</span> <span class="va">user</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">user_id</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">users</span>, <span class="kw">function</span><span class="op">(</span><span class="va">user</span><span class="op">)</span> <span class="va">user</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">user_name</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu">updateSelectInput</span><span class="op">(</span><span class="va">session</span>, <span class="st">"user_id"</span>, choices <span class="op">=</span> <span class="va">choices</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="with-engine-for-transaction-management">With.Engine() for Transaction Management<a class="anchor" aria-label="anchor" href="#with-engine-for-transaction-management"></a>
</h2>
<p>The <code><a href="../reference/with.Engine.html">with.Engine()</a></code> function provides robust transaction
management for database operations. It automatically begins a
transaction, executes your code, and then either commits or rolls back
the transaction based on the outcome. This is particularly valuable in
Shiny applications where you need to ensure data integrity across
multiple database operations.</p>
<div class="section level3">
<h3 id="key-features">Key Features:<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Automatic Transaction Management</strong>: Begins and
commits transactions automatically</li>
<li>
<strong>Error Handling</strong>: Automatically rolls back on errors
to prevent partial updates</li>
<li>
<strong>Manual Control</strong>: Allows explicit
<code>commit()</code> and <code>rollback()</code> calls within the
transaction block</li>
<li>
<strong>Atomicity</strong>: Ensures all operations succeed or none
do</li>
</ol>
</div>
<div class="section level3">
<h3 id="basic-usage-in-shiny">Basic Usage in Shiny:<a class="anchor" aria-label="anchor" href="#basic-usage-in-shiny"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add_observation</span>, <span class="op">{</span></span>
<span>    <span class="co"># observer_id and plant_height are the values from the form inputs</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">engine</span>, <span class="op">{</span></span>
<span>        <span class="va">observation</span> <span class="op">=</span> <span class="va">Observations</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>            observer_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">observer_id</span>,</span>
<span>            plant_subject_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">plant_subject_id</span>,</span>
<span>            plant_height <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">plant_height</span></span>
<span>        <span class="op">)</span></span>
<span>        <span class="va">observation</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="co"># All changes are automatically committed if no errors occur</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">showNotification</span><span class="op">(</span><span class="st">"Observation added!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="flushing-data-for-immediate-feedback">Flushing Data for Immediate Feedback<a class="anchor" aria-label="anchor" href="#flushing-data-for-immediate-feedback"></a>
</h2>
<p>When working with databases in Shiny applications, you often need to
retrieve server-generated values (like auto-increment IDs) immediately
after creating records. The <code>flush_record</code> parameter in the
<code>create()</code> method enables this functionality, allowing you to
access these values before committing the transaction.</p>
<div class="section level3">
<h3 id="how-flushing-works">How Flushing Works:<a class="anchor" aria-label="anchor" href="#how-flushing-works"></a>
</h3>
<ol style="list-style-type: decimal">
<li>The <code>create(flush_record = TRUE)</code> call performs an insert
operation that returns server-generated values</li>
<li>These values are immediately available in the record’s
<code>data</code> property</li>
<li>You can use these values to update UI elements or for subsequent
operations</li>
<li>Different database dialects handle this differently, but oRm
abstracts these differences</li>
</ol>
</div>
<div class="section level3">
<h3 id="example-with-auto-incrementing-ids">Example with Auto-incrementing IDs:<a class="anchor" aria-label="anchor" href="#example-with-auto-incrementing-ids"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setup a model with an auto-incrementing column</span></span>
<span><span class="va">Observations</span> <span class="op">&lt;-</span> <span class="va">engine</span><span class="op">$</span><span class="fu">model</span><span class="op">(</span></span>
<span>    <span class="st">"observations"</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Serial'</span>, primary_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,  <span class="co"># Auto-incrementing ID</span></span>
<span>    observer_id <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Integer'</span><span class="op">)</span>,</span>
<span>    plant_subject_id <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Integer'</span><span class="op">)</span>,</span>
<span>    plant_height <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Numeric'</span>, nullable <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    timestamp <span class="op">=</span> <span class="fu"><a href="../reference/Column.html">Column</a></span><span class="op">(</span><span class="st">'Timestamp'</span>, default <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Track observation count in a reactive value</span></span>
<span><span class="va">observation_count</span> <span class="op">&lt;-</span> <span class="fu">reactiveVal</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add_observation</span>, <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/with.Engine.html">with.Engine</a></span><span class="op">(</span><span class="va">engine</span>, <span class="op">{</span></span>
<span>        <span class="co"># Create record with flush_record = TRUE to get the ID immediately</span></span>
<span>        <span class="va">observation</span> <span class="op">&lt;-</span> <span class="va">Observations</span><span class="op">$</span><span class="fu">record</span><span class="op">(</span></span>
<span>            observer_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">observer_id</span>,</span>
<span>            plant_subject_id <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">plant_subject_id</span>,</span>
<span>            plant_height <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">plant_height</span></span>
<span>        <span class="op">)</span></span>
<span>        </span>
<span>        <span class="co"># This returns the ID immediately, even before commit</span></span>
<span>        <span class="va">observation</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span>flush_record <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="co"># Now we can use the ID for UI updates</span></span>
<span>        <span class="va">current_id</span> <span class="op">&lt;-</span> <span class="va">observation</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">id</span></span>
<span>        <span class="fu">observation_count</span><span class="op">(</span><span class="va">current_id</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="co"># And for related records</span></span>
<span>        <span class="va">ObservationNotes</span><span class="op">$</span><span class="fu">record</span><span class="op">(</span></span>
<span>            observation_id <span class="op">=</span> <span class="va">current_id</span>,</span>
<span>            note <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">notes</span></span>
<span>        <span class="op">)</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Show feedback with the new observation ID</span></span>
<span>    <span class="fu">showNotification</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Added observation #"</span>, <span class="fu">observation_count</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Update a plot or table with the new data</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">observation_plot</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="co"># Plot using the latest observation count</span></span>
<span>        <span class="fu">plot_observations</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu">observation_count</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="database-specific-behavior">Database-Specific Behavior:<a class="anchor" aria-label="anchor" href="#database-specific-behavior"></a>
</h3>
<p>Different databases handle returning values differently:</p>
<ul>
<li>PostgreSQL: Uses RETURNING clause to fetch values in the same
query<br>
</li>
<li>SQLite: Uses last_insert_rowid() to get the most recent ID<br>
</li>
<li>MySQL/MariaDB: Uses LAST_INSERT_ID() function</li>
</ul>
<p>oRm handles these differences through dialect-specific
implementations, so your code remains consistent regardless of the
database backend. When to Use Flushing: Use flush_record = TRUE when you
need to:</p>
<ol style="list-style-type: decimal">
<li>Display server-generated IDs or timestamps to users<br>
</li>
<li>Create related records that reference the new record’s ID<br>
</li>
<li>Update reactive UI elements based on the new record<br>
</li>
<li>Track the progress of batch operations</li>
</ol>
<p>This approach is particularly valuable in interactive Shiny
applications where immediate feedback improves the user experience.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kent Orr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
